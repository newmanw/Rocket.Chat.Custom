name: merge

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      LAST_VERSION: $(cat last-release.txt)

    steps:
    - name: Clone Rocket.Chat.ReactNative
      uses: actions/checkout@master
      with:
        repository: RocketChat/Rocket.Chat.ReactNative
        path: 'Rocket.Chat.ReactNative.Repo'
    - name: Check Release
      if: $(git tag --sort=committerdate | tail -1) == '0.0'
      run: |
        exit 1
      working-directory: Rocket.Chat.ReactNative.Repo
    - name: Set version
      id: version
      run: |
        echo ------
        echo ${{env.LAST_VERSION}}
        echo ------
        echo "::set-output name=version::$(git tag --sort=committerdate | tail -1)"
      working-directory: Rocket.Chat.ReactNative.Repo
    - name: List Release
      run: |
        echo ${{steps.version.outputs.version}}
    - uses: actions/checkout@v2
    - name: Use Node.js
      uses: actions/setup-node@v1
      with:
        node-version: '14.x'
    - name: set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8
    - name: Install Dependencies
      run: |
        npm install
    # - name: merge styles
    #   run: |
    #     npm run merge ./Rocket.Chat.ReactNative.Repo
    # - name: React Native Bundle
    #   run: |
    #     cd Rocket.Chat.ReactNative.Repo
    #     yarn && npx react-native bundle --platform android --dev false --entry-file index.js --bundle-output android/app/src/main/assets/index.android.bundle
    # - name: Build and Sign APK
    #   uses: eskatos/gradle-command-action@v1
    #   with:
    #     wrapper-directory: Rocket.Chat.ReactNative.Repo/android
    #     build-root-directory: Rocket.Chat.ReactNative.Repo/android
    #     arguments: assembleOfficialFossRelease
    #       -PKEYSTORE=${{ secrets.KEYSTORE }}
    #       -PKEYSTORE_PASSWORD=${{ secrets.KEYSTORE_PASSWORD }}
    #       -PKEY_ALIAS=${{ secrets.KEY_ALIAS }}
    #       -PKEY_PASSWORD=${{ secrets.KEY_PASSWORD }}
    #     wrapper-cache-enabled: true
    #     dependencies-cache-enabled: true
    #     configuration-cache-enabled: true
        
        
